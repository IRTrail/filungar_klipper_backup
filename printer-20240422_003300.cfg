[include K-ShakeTune/*.cfg]
[include restore.cfg]
[include backup.cfg]
[include mainsail.cfg]
[include cartographer.cfg]
[include sensorless.cfg]
[include macros.cfg]
[include led_control.cfg]

[virtual_sdcard]
path: /home/biqu/printer_data/gcodes
on_error_gcode: CANCEL_PRINT

[mcu]
canbus_uuid: 63f96c42e5a5

[mcu EBB36]
canbus_uuid: 9e5f2c5905dc

[printer]
kinematics: corexy
max_velocity: 500  
max_accel: 13000    			#Max 4000
max_z_velocity: 15 			#Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0

[temperature_sensor MCU]
sensor_type: temperature_mcu

[temperature_sensor CB1]
sensor_type: temperature_host

#####################################################################
# 	X/Y Stepper Settings
#####################################################################
#	[X in MOTOR1] - B Motor
#	[Y in MOTOR2] - A Motor
#	[E in MOTOR8] - Extruder
#####################################################################

## X Stepper on Motor 6 (B Motor)
[stepper_x]
step_pin: PA10
dir_pin: PA14
enable_pin: !PA15
microsteps: 16
rotation_distance: 40
full_steps_per_rotation:200  #set to 400 for 0.9 degree stepper
endstop_pin: tmc2209_stepper_x:virtual_endstop
position_min: 0
position_endstop: 350
position_max: 350
homing_speed: 20   #Max 100
homing_retract_dist: 5
homing_positive_dir: true

##	Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_x]
uart_pin: PF8
interpolate: False
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0
diag_pin: ^PC2 # use the same pin that was previously the endstop_pin!
driver_SGTHRS: 70

## Y Stepper on Motor 1 (A Motor)
[stepper_y]
step_pin: PE2
dir_pin: PB4
enable_pin: !PC11
microsteps: 16
rotation_distance: 40
full_steps_per_rotation:200  #set to 400 for 0.9 degree stepper
endstop_pin: tmc2209_stepper_y:virtual_endstop
position_min: 0
position_endstop: 350
position_max: 350
homing_speed: 20  #Max 100
homing_retract_dist: 5
homing_positive_dir: true

##	Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_y]
uart_pin: PC10
interpolate: False
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0
diag_pin: ^PF3 # use the same pin that was previously the endstop_pin!
driver_SGTHRS: 70

#####################################################################
# 	Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left on Motor 5
[stepper_z]
step_pin: PC9
dir_pin: !PC8
enable_pin: !PD1
# Rotation Distance for TR8x8 = 8, TR8x4 = 4, TR8x2 = 2
rotation_distance: 4    
microsteps: 32
endstop_pin: probe:z_virtual_endstop
position_max: 250
position_min: -2.5
homing_speed: 8.0 # Leadscrews are slower than 2.4, 10 is a recommended max.
second_homing_speed: 3
homing_retract_dist: 0

##	Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z]
uart_pin: PD0
interpolate: False
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z1 Stepper - Rear on Motor 4
[stepper_z1]
step_pin: PD3
dir_pin: !PD2
enable_pin: !PD5
# Rotation Distance for TR8x8 = 8, TR8x4 = 4, TR8x2 = 2
rotation_distance: 4  
microsteps: 32

##	Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z1]
uart_pin: PD4
interpolate: False
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z2 Stepper - Front Right on Motor 3
[stepper_z2]
step_pin: PD7
dir_pin: !PD6
enable_pin: !PF10
# Rotation Distance for TR8x8 = 8, TR8x4 = 4, TR8x2 = 2
rotation_distance: 4  
microsteps: 32

##	Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z2]
uart_pin: PF9
interpolate: False
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0

#####################################################################
# 	Extruder
#####################################################################

#	E0 on EBB36
[extruder]
step_pin: EBB36: PD0
dir_pin: EBB36: PD1
enable_pin: !EBB36: PD2
##  Update value below when you perform extruder calibration
##  If you ask for 100mm of filament, but in reality it is 98mm:
##  rotation_distance = <previous_rotation_distance> * <actual_extrude_distance> / 100
##  22.6789511 is a good starting point
rotation_distance: 48.472010496
gear_ratio: 9:1
microsteps: 16
full_steps_per_rotation: 200    #200 for 1.8 degree, 400 for 0.9 degree
nozzle_diameter: 0.400
filament_diameter: 1.75
heater_pin: EBB36: PB13
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: EBB36:PA3
min_temp: 10
max_temp: 300
max_power: 1.0
min_extrude_temp: 150
pressure_advance: 0.05
pressure_advance_smooth_time: 0.040
max_extrude_cross_section: 1.0

##	E0 on EBB36
[tmc2209 extruder]
uart_pin: EBB36: PA15
interpolate: false
run_current: 0.5
sense_resistor: 0.110
stealthchop_threshold: 0

#####################################################################
# 	Bed Heater
#####################################################################

[heater_bed]
##	SSR Pin - HE1
heater_pin: PB7 
sensor_type: Generic 3950
sensor_pin: PA0
max_power: 1.0
min_temp: 0
max_temp: 120

#####################################################################
# 	Temperature Sensors
#####################################################################

[temperature_sensor chamber]
sensor_type: Generic 3950
sensor_pin: PA1

[temperature_sensor frame]
sensor_type: Generic 3950
sensor_pin: PA2

#####################################################################
# 	Fan Control
#####################################################################

[fan]
##	Print Cooling Fan - EBB36
pin: EBB36: PA0
kick_start_time: 0.5
##	Depending on your fan, you may need to increase this value
##	if your fan will not start. Can change cycle_time (increase)
##	if your fan is not able to slow down effectively
off_below: 0.10

[heater_fan hotend_fan]
##	Hotend Fan - EBB36
pin: EBB36: PA1
max_power: 1.0
kick_start_time: 0.5
heater: extruder
heater_temp: 50.0
##	If you are experiencing back flow, you can reduce fan_speed
#fan_speed: 1.0

[controller_fan controller_fan_fwd]
pin: PE0
kick_start_time: 0.5
heater: heater_bed
max_power: 1.0
fan_speed: 0.5
shutdown_speed: 1.0
idle_speed: 0.25

[controller_fan controller_fan_aft]
pin: PE6
kick_start_time: 0.5
heater: heater_bed
max_power: 1.0
fan_speed: 0.5
shutdown_speed: 1.0
idle_speed: 0.25

#####################################################################
# 	Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 1800

[z_tilt]
##  Use Z_TILT_ADJUST to level the bed .
##  z_positions: Location of toolhead

z_positions:
   -50, 18
   175, 398
   400, 18
points:
   30, 5
   175, 285
   320, 5

speed: 200
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.005

#####################################################################
# 	Bed Meshing
#####################################################################

[bed_mesh]
speed: 120
horizontal_move_z: 5
mesh_min: 25, 25
mesh_max: 325, 325
zero_reference_position: 175, 175
probe_count: 50, 50
algorithm: bicubic
bicubic_tension: 0.2
move_check_distance: 5
split_delta_z: .025
fade_start: 1
fade_end: 10
fade_target: 0
adaptive_margin: 5

#####################################################################
# 	Displays
#####################################################################

[display]
#	mini12864 LCD Display
lcd_type: uc1701
cs_pin: PE11
a0_pin: PE12
rst_pin: PE13
encoder_pins: ^PE7, ^PF7
click_pin: ^!PE10
contrast: 63
spi_software_miso_pin: PB14
spi_software_mosi_pin: PB11
spi_software_sclk_pin: PB13

#####################################################################
# 	Input Shaping
#####################################################################

[lis2dw]
cs_pin: cartographer:PA3
spi_bus: spi1
axes_map: x,y,z

[resonance_tester]
accel_chip: lis2dw
probe_points:
    175, 175, 20

[input_shaper]
shaper_freq_x: 66.0 # center frequency for the X axis filter
shaper_type_x: mzv # filter type for the X axis
shaper_freq_y: 43.6 # center frequency for the Y axis filter
shaper_type_y: mzv # filter type for the Y axis
damping_ratio_x: 0.050 # damping ratio for the X axis
damping_ratio_y: 0.057 # damping ratio for the Y axis

#####################################################################
# 	Miscelaneous
#####################################################################

# Enable excluded objects
[exclude_object]

# Enable arcs support
[gcode_arcs]
resolution: 0.1

# Enables pauses in macros
[pause_resume]


#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 20.984
#*# pid_ki = 1.332
#*# pid_kd = 82.625
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 54.679
#*# pid_ki = 2.293
#*# pid_kd = 326.022
#*#
#*# [cartographer model default]
#*# model_coef = 1.4263692289175776,
#*# 	  1.7859789769476366,
#*# 	  0.8224830532228761,
#*# 	  0.2836640553204136,
#*# 	  -0.07575005085587751,
#*# 	  0.799329690083614,
#*# 	  0.683405254070958,
#*# 	  -1.1596382394476055,
#*# 	  -0.3043886690315158,
#*# 	  0.743552842443077
#*# model_domain = 3.250475122121728e-07,3.3865115993018035e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 62.722392
#*# model_offset = 0.00000
